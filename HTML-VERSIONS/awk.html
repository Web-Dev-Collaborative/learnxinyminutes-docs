<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>awk.html</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<p>AWK is a standard tool on every POSIX-compliant UNIX system. It’s like flex/lex, from the command-line, perfect for text-processing tasks and other scripting needs. It has a C-like syntax, but without mandatory semicolons (although, you should use them anyway, because they are required when you’re writing one-liners, something AWK excels at), manual memory management, or static typing. It excels at text processing. You can call to it from a shell script, or you can use it as a stand-alone scripting language.</p>
<p>Why use AWK instead of Perl? Readability. AWK is easier to read than Perl. For simple text-processing scripts, particularly ones that read files line by line and split on delimiters, AWK is probably the right tool for the job.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode awk"><code class="sourceCode awk"><a class="sourceLine" id="cb1-1" title="1"><span class="co">#!/usr/bin/awk -f</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co"># Comments are like this</span></a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co"># AWK programs consist of a collection of patterns and actions.</span></a>
<a class="sourceLine" id="cb1-7" title="7">pattern1 { action; } <span class="co"># just like lex</span></a>
<a class="sourceLine" id="cb1-8" title="8">pattern2 { action; }</a>
<a class="sourceLine" id="cb1-9" title="9"></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co"># There is an implied loop and AWK automatically reads and parses each</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co"># record of each file supplied. Each record is split by the FS delimiter,</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co"># which defaults to white-space (multiple spaces,tabs count as one)</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co"># You can assign FS either on the command line (-F C) or in your </span><span class="re">BEGIN</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co"># pattern</span></a>
<a class="sourceLine" id="cb1-15" title="15"></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="co"># One of the special patterns is </span><span class="re">BEGIN</span><span class="co">. The </span><span class="re">BEGIN</span><span class="co"> pattern is true</span></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="co"># BEFORE any of the files are read. The </span><span class="re">END</span><span class="co"> pattern is true after</span></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co"># an End-of-file from the last file (or standard-in if no files specified)</span></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="co"># There is also an output field separator (OFS) that you can assign, which</span></a>
<a class="sourceLine" id="cb1-20" title="20"><span class="co"># defaults to a single space</span></a>
<a class="sourceLine" id="cb1-21" title="21"></a>
<a class="sourceLine" id="cb1-22" title="22"><span class="cf">BEGIN</span> {</a>
<a class="sourceLine" id="cb1-23" title="23"></a>
<a class="sourceLine" id="cb1-24" title="24">    <span class="co"># </span><span class="re">BEGIN</span><span class="co"> will run at the beginning of the program. It&#39;s where you put all</span></a>
<a class="sourceLine" id="cb1-25" title="25">    <span class="co"># the preliminary set-up code, before you process any text files. If you</span></a>
<a class="sourceLine" id="cb1-26" title="26">    <span class="co"># have no text files, then think of </span><span class="re">BEGIN</span><span class="co"> as the main entry point.</span></a>
<a class="sourceLine" id="cb1-27" title="27"></a>
<a class="sourceLine" id="cb1-28" title="28">    <span class="co"># Variables are global. Just set them or use them, no need to declare..</span></a>
<a class="sourceLine" id="cb1-29" title="29">    count <span class="op">=</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb1-30" title="30"></a>
<a class="sourceLine" id="cb1-31" title="31">    <span class="co"># Operators just like in C and friends</span></a>
<a class="sourceLine" id="cb1-32" title="32">    a <span class="op">=</span> count <span class="op">+</span> <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb1-33" title="33">    b <span class="op">=</span> count <span class="op">-</span> <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb1-34" title="34">    c <span class="op">=</span> count <span class="op">*</span> <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb1-35" title="35">    d <span class="op">=</span> count <span class="op">/</span> <span class="dv">1</span>; <span class="co"># integer division</span></a>
<a class="sourceLine" id="cb1-36" title="36">    e <span class="op">=</span> count <span class="op">%</span> <span class="dv">1</span>; <span class="co"># modulus</span></a>
<a class="sourceLine" id="cb1-37" title="37">    f <span class="op">=</span> count <span class="op">^</span> <span class="dv">1</span>; <span class="co"># exponentiation</span></a>
<a class="sourceLine" id="cb1-38" title="38"></a>
<a class="sourceLine" id="cb1-39" title="39">    a <span class="op">+=</span> <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb1-40" title="40">    b <span class="op">-=</span> <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb1-41" title="41">    c <span class="op">*=</span> <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb1-42" title="42">    d <span class="op">/=</span> <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb1-43" title="43">    e <span class="op">%=</span> <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb1-44" title="44">    f <span class="op">^=</span> <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb1-45" title="45"></a>
<a class="sourceLine" id="cb1-46" title="46">    <span class="co"># Incrementing and decrementing by one</span></a>
<a class="sourceLine" id="cb1-47" title="47">    a<span class="op">++</span>;</a>
<a class="sourceLine" id="cb1-48" title="48">    b<span class="op">--</span>;</a>
<a class="sourceLine" id="cb1-49" title="49"></a>
<a class="sourceLine" id="cb1-50" title="50">    <span class="co"># As a prefix operator, it returns the incremented value</span></a>
<a class="sourceLine" id="cb1-51" title="51">    <span class="op">++</span>a;</a>
<a class="sourceLine" id="cb1-52" title="52">    <span class="op">--</span>b;</a>
<a class="sourceLine" id="cb1-53" title="53"></a>
<a class="sourceLine" id="cb1-54" title="54">    <span class="co"># Notice, also, no punctuation such as semicolons to terminate statements</span></a>
<a class="sourceLine" id="cb1-55" title="55"></a>
<a class="sourceLine" id="cb1-56" title="56">    <span class="co"># Control statements</span></a>
<a class="sourceLine" id="cb1-57" title="57">    <span class="cf">if</span> (count <span class="op">==</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-58" title="58">        <span class="kw">print</span> <span class="st">&quot;Starting with count of 0&quot;</span>;</a>
<a class="sourceLine" id="cb1-59" title="59">    <span class="cf">else</span></a>
<a class="sourceLine" id="cb1-60" title="60">        <span class="kw">print</span> <span class="st">&quot;Huh?&quot;</span>;</a>
<a class="sourceLine" id="cb1-61" title="61"></a>
<a class="sourceLine" id="cb1-62" title="62">    <span class="co"># Or you could use the ternary operator</span></a>
<a class="sourceLine" id="cb1-63" title="63">    <span class="kw">print</span> (count <span class="op">==</span> <span class="dv">0</span>) <span class="op">?</span> <span class="st">&quot;Starting with count of 0&quot;</span> <span class="op">:</span> <span class="st">&quot;Huh?&quot;</span>;</a>
<a class="sourceLine" id="cb1-64" title="64"></a>
<a class="sourceLine" id="cb1-65" title="65">    <span class="co"># Blocks consisting of multiple lines use braces</span></a>
<a class="sourceLine" id="cb1-66" title="66">    <span class="cf">while</span> (a <span class="op">&lt;</span> <span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb1-67" title="67">        <span class="kw">print</span> <span class="st">&quot;String concatenation is done&quot;</span> <span class="st">&quot; with a series&quot;</span> <span class="st">&quot; of&quot;</span></a>
<a class="sourceLine" id="cb1-68" title="68">            <span class="st">&quot; space-separated strings&quot;</span>;</a>
<a class="sourceLine" id="cb1-69" title="69">        <span class="kw">print</span> a;</a>
<a class="sourceLine" id="cb1-70" title="70"></a>
<a class="sourceLine" id="cb1-71" title="71">        a<span class="op">++</span>;</a>
<a class="sourceLine" id="cb1-72" title="72">    }</a>
<a class="sourceLine" id="cb1-73" title="73"></a>
<a class="sourceLine" id="cb1-74" title="74">    <span class="cf">for</span> (i <span class="op">=</span> <span class="dv">0</span>; i <span class="op">&lt;</span> <span class="dv">10</span>; i<span class="op">++</span>)</a>
<a class="sourceLine" id="cb1-75" title="75">        <span class="kw">print</span> <span class="st">&quot;Good ol&#39; for loop&quot;</span>;</a>
<a class="sourceLine" id="cb1-76" title="76"></a>
<a class="sourceLine" id="cb1-77" title="77">    <span class="co"># As for comparisons, they&#39;re the standards:</span></a>
<a class="sourceLine" id="cb1-78" title="78">    <span class="co"># a &lt; b   # Less than</span></a>
<a class="sourceLine" id="cb1-79" title="79">    <span class="co"># a &lt;= b  # Less than or equal</span></a>
<a class="sourceLine" id="cb1-80" title="80">    <span class="co"># a != b  # Not equal</span></a>
<a class="sourceLine" id="cb1-81" title="81">    <span class="co"># a == b  # Equal</span></a>
<a class="sourceLine" id="cb1-82" title="82">    <span class="co"># a &gt; b   # Greater than</span></a>
<a class="sourceLine" id="cb1-83" title="83">    <span class="co"># a &gt;= b  # Greater than or equal</span></a>
<a class="sourceLine" id="cb1-84" title="84"></a>
<a class="sourceLine" id="cb1-85" title="85">    <span class="co"># Logical operators as well</span></a>
<a class="sourceLine" id="cb1-86" title="86">    <span class="co"># a &amp;&amp; b  # AND</span></a>
<a class="sourceLine" id="cb1-87" title="87">    <span class="co"># a || b  # OR</span></a>
<a class="sourceLine" id="cb1-88" title="88"></a>
<a class="sourceLine" id="cb1-89" title="89">    <span class="co"># In addition, there&#39;s the super useful regular expression match</span></a>
<a class="sourceLine" id="cb1-90" title="90">    <span class="cf">if</span> (<span class="st">&quot;foo&quot;</span> <span class="op">~</span> <span class="st">&quot;^fo+$&quot;</span>)</a>
<a class="sourceLine" id="cb1-91" title="91">        <span class="kw">print</span> <span class="st">&quot;Fooey!&quot;</span>;</a>
<a class="sourceLine" id="cb1-92" title="92">    <span class="cf">if</span> (<span class="st">&quot;boo&quot;</span> <span class="op">!~</span> <span class="st">&quot;^fo+$&quot;</span>)</a>
<a class="sourceLine" id="cb1-93" title="93">        <span class="kw">print</span> <span class="st">&quot;Boo!&quot;</span>;</a>
<a class="sourceLine" id="cb1-94" title="94"></a>
<a class="sourceLine" id="cb1-95" title="95">    <span class="co"># Arrays</span></a>
<a class="sourceLine" id="cb1-96" title="96">    arr[<span class="dv">0</span>] <span class="op">=</span> <span class="st">&quot;foo&quot;</span>;</a>
<a class="sourceLine" id="cb1-97" title="97">    arr[<span class="dv">1</span>] <span class="op">=</span> <span class="st">&quot;bar&quot;</span>;</a>
<a class="sourceLine" id="cb1-98" title="98">    </a>
<a class="sourceLine" id="cb1-99" title="99">    <span class="co"># You can also initialize an array with the built-in function split()</span></a>
<a class="sourceLine" id="cb1-100" title="100">    </a>
<a class="sourceLine" id="cb1-101" title="101">    n <span class="op">=</span> <span class="fu">split</span>(<span class="st">&quot;foo:bar:baz&quot;</span>, arr, <span class="st">&quot;:&quot;</span>);</a>
<a class="sourceLine" id="cb1-102" title="102">   </a>
<a class="sourceLine" id="cb1-103" title="103">    <span class="co"># You also have associative arrays (actually, they&#39;re all associative arrays)</span></a>
<a class="sourceLine" id="cb1-104" title="104">    assoc[<span class="st">&quot;foo&quot;</span>] <span class="op">=</span> <span class="st">&quot;bar&quot;</span>;</a>
<a class="sourceLine" id="cb1-105" title="105">    assoc[<span class="st">&quot;bar&quot;</span>] <span class="op">=</span> <span class="st">&quot;baz&quot;</span>;</a>
<a class="sourceLine" id="cb1-106" title="106"></a>
<a class="sourceLine" id="cb1-107" title="107">    <span class="co"># And multi-dimensional arrays, with some limitations I won&#39;t mention here</span></a>
<a class="sourceLine" id="cb1-108" title="108">    multidim[<span class="dv">0</span>,<span class="dv">0</span>] <span class="op">=</span> <span class="st">&quot;foo&quot;</span>;</a>
<a class="sourceLine" id="cb1-109" title="109">    multidim[<span class="dv">0</span>,<span class="dv">1</span>] <span class="op">=</span> <span class="st">&quot;bar&quot;</span>;</a>
<a class="sourceLine" id="cb1-110" title="110">    multidim[<span class="dv">1</span>,<span class="dv">0</span>] <span class="op">=</span> <span class="st">&quot;baz&quot;</span>;</a>
<a class="sourceLine" id="cb1-111" title="111">    multidim[<span class="dv">1</span>,<span class="dv">1</span>] <span class="op">=</span> <span class="st">&quot;boo&quot;</span>;</a>
<a class="sourceLine" id="cb1-112" title="112"></a>
<a class="sourceLine" id="cb1-113" title="113">    <span class="co"># You can test for array membership</span></a>
<a class="sourceLine" id="cb1-114" title="114">    <span class="cf">if</span> (<span class="st">&quot;foo&quot;</span> <span class="kw">in</span> assoc)</a>
<a class="sourceLine" id="cb1-115" title="115">        <span class="kw">print</span> <span class="st">&quot;Fooey!&quot;</span>;</a>
<a class="sourceLine" id="cb1-116" title="116"></a>
<a class="sourceLine" id="cb1-117" title="117">    <span class="co"># You can also use the &#39;in&#39; operator to traverse the keys of an array</span></a>
<a class="sourceLine" id="cb1-118" title="118">    <span class="cf">for</span> (key <span class="kw">in</span> assoc)</a>
<a class="sourceLine" id="cb1-119" title="119">        <span class="kw">print</span> assoc[key];</a>
<a class="sourceLine" id="cb1-120" title="120"></a>
<a class="sourceLine" id="cb1-121" title="121">    <span class="co"># The command line is in a special array called ARGV</span></a>
<a class="sourceLine" id="cb1-122" title="122">    <span class="cf">for</span> (argnum <span class="kw">in</span> <span class="bu">ARGV</span>)</a>
<a class="sourceLine" id="cb1-123" title="123">        <span class="kw">print</span> <span class="bu">ARGV</span>[argnum];</a>
<a class="sourceLine" id="cb1-124" title="124"></a>
<a class="sourceLine" id="cb1-125" title="125">    <span class="co"># You can remove elements of an array</span></a>
<a class="sourceLine" id="cb1-126" title="126">    <span class="co"># This is particularly useful to prevent AWK from assuming the arguments</span></a>
<a class="sourceLine" id="cb1-127" title="127">    <span class="co"># are files for it to process</span></a>
<a class="sourceLine" id="cb1-128" title="128">    <span class="kw">delete</span> <span class="bu">ARGV</span>[<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb1-129" title="129"></a>
<a class="sourceLine" id="cb1-130" title="130">    <span class="co"># The number of command line arguments is in a variable called ARGC</span></a>
<a class="sourceLine" id="cb1-131" title="131">    <span class="kw">print</span> <span class="bu">ARGC</span>;</a>
<a class="sourceLine" id="cb1-132" title="132"></a>
<a class="sourceLine" id="cb1-133" title="133">    <span class="co"># AWK has several built-in functions. They fall into three categories. I&#39;ll</span></a>
<a class="sourceLine" id="cb1-134" title="134">    <span class="co"># demonstrate each of them in their own functions, defined later.</span></a>
<a class="sourceLine" id="cb1-135" title="135"></a>
<a class="sourceLine" id="cb1-136" title="136">    return_value <span class="op">=</span> arithmetic_functions(a, b, c);</a>
<a class="sourceLine" id="cb1-137" title="137">    string_functions();</a>
<a class="sourceLine" id="cb1-138" title="138">    io_functions();</a>
<a class="sourceLine" id="cb1-139" title="139">}</a>
<a class="sourceLine" id="cb1-140" title="140"></a>
<a class="sourceLine" id="cb1-141" title="141"><span class="co"># Here&#39;s how you define a function</span></a>
<a class="sourceLine" id="cb1-142" title="142"><span class="kw">function</span> arithmetic_functions(a, b, c,     d) {</a>
<a class="sourceLine" id="cb1-143" title="143"></a>
<a class="sourceLine" id="cb1-144" title="144">    <span class="co"># Probably the most annoying part of AWK is that there are no local</span></a>
<a class="sourceLine" id="cb1-145" title="145">    <span class="co"># variables. Everything is global. For short scripts, this is fine, even</span></a>
<a class="sourceLine" id="cb1-146" title="146">    <span class="co"># useful, but for longer scripts, this can be a problem.</span></a>
<a class="sourceLine" id="cb1-147" title="147"></a>
<a class="sourceLine" id="cb1-148" title="148">    <span class="co"># There is a work-around (ahem, hack). Function arguments are local to the</span></a>
<a class="sourceLine" id="cb1-149" title="149">    <span class="co"># function, and AWK allows you to define more function arguments than it</span></a>
<a class="sourceLine" id="cb1-150" title="150">    <span class="co"># needs. So just stick local variable in the function declaration, like I</span></a>
<a class="sourceLine" id="cb1-151" title="151">    <span class="co"># did above. As a convention, stick in some extra whitespace to distinguish</span></a>
<a class="sourceLine" id="cb1-152" title="152">    <span class="co"># between actual function parameters and local variables. In this example,</span></a>
<a class="sourceLine" id="cb1-153" title="153">    <span class="co"># a, b, and c are actual parameters, while d is merely a local variable.</span></a>
<a class="sourceLine" id="cb1-154" title="154"></a>
<a class="sourceLine" id="cb1-155" title="155">    <span class="co"># Now, to demonstrate the arithmetic functions</span></a>
<a class="sourceLine" id="cb1-156" title="156"></a>
<a class="sourceLine" id="cb1-157" title="157">    <span class="co"># Most AWK implementations have some standard trig functions</span></a>
<a class="sourceLine" id="cb1-158" title="158">    localvar <span class="op">=</span> <span class="fu">sin</span>(a);</a>
<a class="sourceLine" id="cb1-159" title="159">    localvar <span class="op">=</span> <span class="fu">cos</span>(a);</a>
<a class="sourceLine" id="cb1-160" title="160">    localvar <span class="op">=</span> <span class="fu">atan2</span>(b, a); <span class="co"># arc tangent of b / a</span></a>
<a class="sourceLine" id="cb1-161" title="161"></a>
<a class="sourceLine" id="cb1-162" title="162">    <span class="co"># And logarithmic stuff</span></a>
<a class="sourceLine" id="cb1-163" title="163">    localvar <span class="op">=</span> <span class="fu">exp</span>(a);</a>
<a class="sourceLine" id="cb1-164" title="164">    localvar <span class="op">=</span> <span class="fu">log</span>(a);</a>
<a class="sourceLine" id="cb1-165" title="165"></a>
<a class="sourceLine" id="cb1-166" title="166">    <span class="co"># Square root</span></a>
<a class="sourceLine" id="cb1-167" title="167">    localvar <span class="op">=</span> <span class="fu">sqrt</span>(a);</a>
<a class="sourceLine" id="cb1-168" title="168"></a>
<a class="sourceLine" id="cb1-169" title="169">    <span class="co"># Truncate floating point to integer</span></a>
<a class="sourceLine" id="cb1-170" title="170">    localvar <span class="op">=</span> <span class="fu">int</span>(<span class="fl">5.34</span>); <span class="co"># localvar =&gt; 5</span></a>
<a class="sourceLine" id="cb1-171" title="171"></a>
<a class="sourceLine" id="cb1-172" title="172">    <span class="co"># Random numbers</span></a>
<a class="sourceLine" id="cb1-173" title="173">    <span class="fu">srand</span>(); <span class="co"># Supply a seed as an argument. By default, it uses the time of day</span></a>
<a class="sourceLine" id="cb1-174" title="174">    localvar <span class="op">=</span> <span class="fu">rand</span>(); <span class="co"># Random number between 0 and 1.</span></a>
<a class="sourceLine" id="cb1-175" title="175"></a>
<a class="sourceLine" id="cb1-176" title="176">    <span class="co"># Here&#39;s how to return a value</span></a>
<a class="sourceLine" id="cb1-177" title="177">    <span class="cf">return</span> localvar;</a>
<a class="sourceLine" id="cb1-178" title="178">}</a>
<a class="sourceLine" id="cb1-179" title="179"></a>
<a class="sourceLine" id="cb1-180" title="180"><span class="kw">function</span> string_functions(    localvar, arr) {</a>
<a class="sourceLine" id="cb1-181" title="181"></a>
<a class="sourceLine" id="cb1-182" title="182">    <span class="co"># AWK, being a string-processing language, has several string-related</span></a>
<a class="sourceLine" id="cb1-183" title="183">    <span class="co"># functions, many of which rely heavily on regular expressions.</span></a>
<a class="sourceLine" id="cb1-184" title="184"></a>
<a class="sourceLine" id="cb1-185" title="185">    <span class="co"># Search and replace, first instance (sub) or all instances (gsub)</span></a>
<a class="sourceLine" id="cb1-186" title="186">    <span class="co"># Both return number of matches replaced</span></a>
<a class="sourceLine" id="cb1-187" title="187">    localvar <span class="op">=</span> <span class="st">&quot;fooooobar&quot;</span>;</a>
<a class="sourceLine" id="cb1-188" title="188">    <span class="fu">sub</span>(<span class="st">&quot;fo+&quot;</span>, <span class="st">&quot;Meet me at the &quot;</span>, localvar); <span class="co"># localvar =&gt; &quot;Meet me at the bar&quot;</span></a>
<a class="sourceLine" id="cb1-189" title="189">    <span class="fu">gsub</span>(<span class="st">&quot;e+&quot;</span>, <span class="st">&quot;.&quot;</span>, localvar); <span class="co"># localvar =&gt; &quot;m..t m. at th. bar&quot;</span></a>
<a class="sourceLine" id="cb1-190" title="190"></a>
<a class="sourceLine" id="cb1-191" title="191">    <span class="co"># Search for a string that matches a regular expression</span></a>
<a class="sourceLine" id="cb1-192" title="192">    <span class="co"># index() does the same thing, but doesn&#39;t allow a regular expression</span></a>
<a class="sourceLine" id="cb1-193" title="193">    <span class="fu">match</span>(localvar, <span class="st">&quot;t&quot;</span>); <span class="co"># =&gt; 4, since the &#39;t&#39; is the fourth character</span></a>
<a class="sourceLine" id="cb1-194" title="194"></a>
<a class="sourceLine" id="cb1-195" title="195">    <span class="co"># Split on a delimiter</span></a>
<a class="sourceLine" id="cb1-196" title="196">    n <span class="op">=</span> <span class="fu">split</span>(<span class="st">&quot;foo-bar-baz&quot;</span>, arr, <span class="st">&quot;-&quot;</span>); <span class="co"># a[1] = &quot;foo&quot;; a[2] = &quot;bar&quot;; a[3] = &quot;baz&quot;; n = 3</span></a>
<a class="sourceLine" id="cb1-197" title="197"></a>
<a class="sourceLine" id="cb1-198" title="198">    <span class="co"># Other useful stuff</span></a>
<a class="sourceLine" id="cb1-199" title="199">    <span class="fu">sprintf</span>(<span class="st">&quot;%s %d %d %d&quot;</span>, <span class="st">&quot;Testing&quot;</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>); <span class="co"># =&gt; &quot;Testing 1 2 3&quot;</span></a>
<a class="sourceLine" id="cb1-200" title="200">    <span class="fu">substr</span>(<span class="st">&quot;foobar&quot;</span>, <span class="dv">2</span>, <span class="dv">3</span>); <span class="co"># =&gt; &quot;oob&quot;</span></a>
<a class="sourceLine" id="cb1-201" title="201">    <span class="fu">substr</span>(<span class="st">&quot;foobar&quot;</span>, <span class="dv">4</span>); <span class="co"># =&gt; &quot;bar&quot;</span></a>
<a class="sourceLine" id="cb1-202" title="202">    <span class="fu">length</span>(<span class="st">&quot;foo&quot;</span>); <span class="co"># =&gt; 3</span></a>
<a class="sourceLine" id="cb1-203" title="203">    <span class="fu">tolower</span>(<span class="st">&quot;FOO&quot;</span>); <span class="co"># =&gt; &quot;foo&quot;</span></a>
<a class="sourceLine" id="cb1-204" title="204">    <span class="fu">toupper</span>(<span class="st">&quot;foo&quot;</span>); <span class="co"># =&gt; &quot;FOO&quot;</span></a>
<a class="sourceLine" id="cb1-205" title="205">}</a>
<a class="sourceLine" id="cb1-206" title="206"></a>
<a class="sourceLine" id="cb1-207" title="207"><span class="kw">function</span> io_functions(    localvar) {</a>
<a class="sourceLine" id="cb1-208" title="208"></a>
<a class="sourceLine" id="cb1-209" title="209">    <span class="co"># You&#39;ve already seen print</span></a>
<a class="sourceLine" id="cb1-210" title="210">    <span class="kw">print</span> <span class="st">&quot;Hello world&quot;</span>;</a>
<a class="sourceLine" id="cb1-211" title="211"></a>
<a class="sourceLine" id="cb1-212" title="212">    <span class="co"># There&#39;s also printf</span></a>
<a class="sourceLine" id="cb1-213" title="213">    <span class="kw">printf</span>(<span class="st">&quot;%s %d %d %d</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="st">&quot;Testing&quot;</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>);</a>
<a class="sourceLine" id="cb1-214" title="214"></a>
<a class="sourceLine" id="cb1-215" title="215">    <span class="co"># AWK doesn&#39;t have file handles, per se. It will automatically open a file</span></a>
<a class="sourceLine" id="cb1-216" title="216">    <span class="co"># handle for you when you use something that needs one. The string you used</span></a>
<a class="sourceLine" id="cb1-217" title="217">    <span class="co"># for this can be treated as a file handle, for purposes of I/O. This makes</span></a>
<a class="sourceLine" id="cb1-218" title="218">    <span class="co"># it feel sort of like shell scripting, but to get the same output, the string</span></a>
<a class="sourceLine" id="cb1-219" title="219">    <span class="co"># must match exactly, so use a variable:</span></a>
<a class="sourceLine" id="cb1-220" title="220">    </a>
<a class="sourceLine" id="cb1-221" title="221">    outfile <span class="op">=</span> <span class="st">&quot;/tmp/foobar.txt&quot;</span>;</a>
<a class="sourceLine" id="cb1-222" title="222"></a>
<a class="sourceLine" id="cb1-223" title="223">    <span class="kw">print</span> <span class="st">&quot;foobar&quot;</span> <span class="op">&gt;</span> outfile;</a>
<a class="sourceLine" id="cb1-224" title="224"></a>
<a class="sourceLine" id="cb1-225" title="225">    <span class="co"># Now the string outfile is a file handle. You can close it:</span></a>
<a class="sourceLine" id="cb1-226" title="226">    <span class="fu">close</span>(outfile);</a>
<a class="sourceLine" id="cb1-227" title="227"></a>
<a class="sourceLine" id="cb1-228" title="228">    <span class="co"># Here&#39;s how you run something in the shell</span></a>
<a class="sourceLine" id="cb1-229" title="229">    <span class="fu">system</span>(<span class="st">&quot;echo foobar&quot;</span>); <span class="co"># =&gt; prints foobar</span></a>
<a class="sourceLine" id="cb1-230" title="230"></a>
<a class="sourceLine" id="cb1-231" title="231">    <span class="co"># Reads a line from standard input and stores in localvar</span></a>
<a class="sourceLine" id="cb1-232" title="232">    <span class="kw">getline</span> localvar;</a>
<a class="sourceLine" id="cb1-233" title="233"></a>
<a class="sourceLine" id="cb1-234" title="234">    <span class="co"># Reads a line from a pipe (again, use a string so you close it properly)</span></a>
<a class="sourceLine" id="cb1-235" title="235">    cmd <span class="op">=</span> <span class="st">&quot;echo foobar&quot;</span>;</a>
<a class="sourceLine" id="cb1-236" title="236">    cmd <span class="op">|</span> <span class="kw">getline</span> localvar; <span class="co"># localvar =&gt; &quot;foobar&quot;</span></a>
<a class="sourceLine" id="cb1-237" title="237">    <span class="fu">close</span>(cmd);</a>
<a class="sourceLine" id="cb1-238" title="238"></a>
<a class="sourceLine" id="cb1-239" title="239">    <span class="co"># Reads a line from a file and stores in localvar</span></a>
<a class="sourceLine" id="cb1-240" title="240">    infile <span class="op">=</span> <span class="st">&quot;/tmp/foobar.txt&quot;</span>;</a>
<a class="sourceLine" id="cb1-241" title="241">    <span class="kw">getline</span> localvar <span class="op">&lt;</span> infile; </a>
<a class="sourceLine" id="cb1-242" title="242">    <span class="fu">close</span>(infile);</a>
<a class="sourceLine" id="cb1-243" title="243">}</a>
<a class="sourceLine" id="cb1-244" title="244"></a>
<a class="sourceLine" id="cb1-245" title="245"><span class="co"># As I said at the beginning, AWK programs consist of a collection of patterns</span></a>
<a class="sourceLine" id="cb1-246" title="246"><span class="co"># and actions. You&#39;ve already seen the </span><span class="re">BEGIN</span><span class="co"> pattern. Other</span></a>
<a class="sourceLine" id="cb1-247" title="247"><span class="co"># patterns are used only if you&#39;re processing lines from files or standard</span></a>
<a class="sourceLine" id="cb1-248" title="248"><span class="co"># input.</span></a>
<a class="sourceLine" id="cb1-249" title="249"><span class="co">#</span></a>
<a class="sourceLine" id="cb1-250" title="250"><span class="co"># When you pass arguments to AWK, they are treated as file names to process.</span></a>
<a class="sourceLine" id="cb1-251" title="251"><span class="co"># It will process them all, in order. Think of it like an implicit for loop,</span></a>
<a class="sourceLine" id="cb1-252" title="252"><span class="co"># iterating over the lines in these files. these patterns and actions are like</span></a>
<a class="sourceLine" id="cb1-253" title="253"><span class="co"># switch statements inside the loop. </span></a>
<a class="sourceLine" id="cb1-254" title="254"></a>
<a class="sourceLine" id="cb1-255" title="255"><span class="ot">/^</span><span class="ss">fo</span><span class="ot">+</span><span class="ss">bar</span><span class="ot">$/</span> {</a>
<a class="sourceLine" id="cb1-256" title="256">    </a>
<a class="sourceLine" id="cb1-257" title="257">    <span class="co"># This action will execute for every line that matches the regular</span></a>
<a class="sourceLine" id="cb1-258" title="258">    <span class="co"># expression, /^fo+bar$/, and will be skipped for any line that fails to</span></a>
<a class="sourceLine" id="cb1-259" title="259">    <span class="co"># match it. Let&#39;s just print the line:</span></a>
<a class="sourceLine" id="cb1-260" title="260"></a>
<a class="sourceLine" id="cb1-261" title="261">    <span class="kw">print</span>;</a>
<a class="sourceLine" id="cb1-262" title="262"></a>
<a class="sourceLine" id="cb1-263" title="263">    <span class="co"># Whoa, no argument! That&#39;s because print has a default argument: $0.</span></a>
<a class="sourceLine" id="cb1-264" title="264">    <span class="co"># $0 is the name of the current line being processed. It is created</span></a>
<a class="sourceLine" id="cb1-265" title="265">    <span class="co"># automatically for you.</span></a>
<a class="sourceLine" id="cb1-266" title="266"></a>
<a class="sourceLine" id="cb1-267" title="267">    <span class="co"># You can probably guess there are other $ variables. Every line is</span></a>
<a class="sourceLine" id="cb1-268" title="268">    <span class="co"># implicitly split before every action is called, much like the shell</span></a>
<a class="sourceLine" id="cb1-269" title="269">    <span class="co"># does. And, like the shell, each field can be access with a dollar sign</span></a>
<a class="sourceLine" id="cb1-270" title="270"></a>
<a class="sourceLine" id="cb1-271" title="271">    <span class="co"># This will print the second and fourth fields in the line</span></a>
<a class="sourceLine" id="cb1-272" title="272">    <span class="kw">print</span> <span class="dt">$2</span>, <span class="dt">$4</span>;</a>
<a class="sourceLine" id="cb1-273" title="273"></a>
<a class="sourceLine" id="cb1-274" title="274">    <span class="co"># AWK automatically defines many other variables to help you inspect and</span></a>
<a class="sourceLine" id="cb1-275" title="275">    <span class="co"># process each line. The most important one is NF</span></a>
<a class="sourceLine" id="cb1-276" title="276"></a>
<a class="sourceLine" id="cb1-277" title="277">    <span class="co"># Prints the number of fields on this line</span></a>
<a class="sourceLine" id="cb1-278" title="278">    <span class="kw">print</span> <span class="bu">NF</span>;</a>
<a class="sourceLine" id="cb1-279" title="279"></a>
<a class="sourceLine" id="cb1-280" title="280">    <span class="co"># Print the last field on this line</span></a>
<a class="sourceLine" id="cb1-281" title="281">    <span class="kw">print</span> <span class="dt">$NF</span>;</a>
<a class="sourceLine" id="cb1-282" title="282">}</a>
<a class="sourceLine" id="cb1-283" title="283"></a>
<a class="sourceLine" id="cb1-284" title="284"><span class="co"># Every pattern is actually a true/false test. The regular expression in the</span></a>
<a class="sourceLine" id="cb1-285" title="285"><span class="co"># last pattern is also a true/false test, but part of it was hidden. If you</span></a>
<a class="sourceLine" id="cb1-286" title="286"><span class="co"># don&#39;t give it a string to test, it will assume $0, the line that it&#39;s</span></a>
<a class="sourceLine" id="cb1-287" title="287"><span class="co"># currently processing. Thus, the complete version of it is this:</span></a>
<a class="sourceLine" id="cb1-288" title="288"></a>
<a class="sourceLine" id="cb1-289" title="289"><span class="dt">$0</span> <span class="op">~</span> <span class="ot">/^</span><span class="ss">fo</span><span class="ot">+</span><span class="ss">bar</span><span class="ot">$/</span> {</a>
<a class="sourceLine" id="cb1-290" title="290">    <span class="kw">print</span> <span class="st">&quot;Equivalent to the last pattern&quot;</span>;</a>
<a class="sourceLine" id="cb1-291" title="291">}</a>
<a class="sourceLine" id="cb1-292" title="292"></a>
<a class="sourceLine" id="cb1-293" title="293">a <span class="op">&gt;</span> <span class="dv">0</span> {</a>
<a class="sourceLine" id="cb1-294" title="294">    <span class="co"># This will execute once for each line, as long as a is positive</span></a>
<a class="sourceLine" id="cb1-295" title="295">}</a>
<a class="sourceLine" id="cb1-296" title="296"></a>
<a class="sourceLine" id="cb1-297" title="297"><span class="co"># You get the idea. Processing text files, reading in a line at a time, and</span></a>
<a class="sourceLine" id="cb1-298" title="298"><span class="co"># doing something with it, particularly splitting on a delimiter, is so common</span></a>
<a class="sourceLine" id="cb1-299" title="299"><span class="co"># in UNIX that AWK is a scripting language that does all of it for you, without</span></a>
<a class="sourceLine" id="cb1-300" title="300"><span class="co"># you needing to ask. All you have to do is write the patterns and actions</span></a>
<a class="sourceLine" id="cb1-301" title="301"><span class="co"># based on what you expect of the input, and what you want to do with it.</span></a>
<a class="sourceLine" id="cb1-302" title="302"></a>
<a class="sourceLine" id="cb1-303" title="303"><span class="co"># Here&#39;s a quick example of a simple script, the sort of thing AWK is perfect</span></a>
<a class="sourceLine" id="cb1-304" title="304"><span class="co"># for. It will read a name from standard input and then will print the average</span></a>
<a class="sourceLine" id="cb1-305" title="305"><span class="co"># age of everyone with that first name. Let&#39;s say you supply as an argument the</span></a>
<a class="sourceLine" id="cb1-306" title="306"><span class="co"># name of a this data file:</span></a>
<a class="sourceLine" id="cb1-307" title="307"><span class="co">#</span></a>
<a class="sourceLine" id="cb1-308" title="308"><span class="co"># Bob Jones 32</span></a>
<a class="sourceLine" id="cb1-309" title="309"><span class="co"># Jane Doe 22</span></a>
<a class="sourceLine" id="cb1-310" title="310"><span class="co"># Steve Stevens 83</span></a>
<a class="sourceLine" id="cb1-311" title="311"><span class="co"># Bob Smith 29</span></a>
<a class="sourceLine" id="cb1-312" title="312"><span class="co"># Bob Barker 72</span></a>
<a class="sourceLine" id="cb1-313" title="313"><span class="co">#</span></a>
<a class="sourceLine" id="cb1-314" title="314"><span class="co"># Here&#39;s the script:</span></a>
<a class="sourceLine" id="cb1-315" title="315"></a>
<a class="sourceLine" id="cb1-316" title="316"><span class="cf">BEGIN</span> {</a>
<a class="sourceLine" id="cb1-317" title="317"></a>
<a class="sourceLine" id="cb1-318" title="318">    <span class="co"># First, ask the user for the name</span></a>
<a class="sourceLine" id="cb1-319" title="319">    <span class="kw">print</span> <span class="st">&quot;What name would you like the average age for?&quot;</span>;</a>
<a class="sourceLine" id="cb1-320" title="320"></a>
<a class="sourceLine" id="cb1-321" title="321">    <span class="co"># Get a line from standard input, not from files on the command line</span></a>
<a class="sourceLine" id="cb1-322" title="322">    <span class="kw">getline</span> name <span class="op">&lt;</span> <span class="st">&quot;/dev/stdin&quot;</span>;</a>
<a class="sourceLine" id="cb1-323" title="323">}</a>
<a class="sourceLine" id="cb1-324" title="324"></a>
<a class="sourceLine" id="cb1-325" title="325"><span class="co"># Now, match every line whose first field is the given name</span></a>
<a class="sourceLine" id="cb1-326" title="326"><span class="dt">$1</span> <span class="op">==</span> name {</a>
<a class="sourceLine" id="cb1-327" title="327"></a>
<a class="sourceLine" id="cb1-328" title="328">    <span class="co"># Inside here, we have access to a number of useful variables, already</span></a>
<a class="sourceLine" id="cb1-329" title="329">    <span class="co"># pre-loaded for us:</span></a>
<a class="sourceLine" id="cb1-330" title="330">    <span class="co"># $0 is the entire line</span></a>
<a class="sourceLine" id="cb1-331" title="331">    <span class="co"># $3 is the third field, the age, which is what we&#39;re interested in here</span></a>
<a class="sourceLine" id="cb1-332" title="332">    <span class="co"># NF is the number of fields, which should be 3</span></a>
<a class="sourceLine" id="cb1-333" title="333">    <span class="co"># NR is the number of records (lines) seen so far</span></a>
<a class="sourceLine" id="cb1-334" title="334">    <span class="co"># FILENAME is the name of the file being processed</span></a>
<a class="sourceLine" id="cb1-335" title="335">    <span class="co"># FS is the field separator being used, which is &quot; &quot; here</span></a>
<a class="sourceLine" id="cb1-336" title="336">    <span class="co"># ...etc. There are plenty more, documented in the man page.</span></a>
<a class="sourceLine" id="cb1-337" title="337"></a>
<a class="sourceLine" id="cb1-338" title="338">    <span class="co"># Keep track of a running total and how many lines matched</span></a>
<a class="sourceLine" id="cb1-339" title="339">    sum <span class="op">+=</span> <span class="dt">$3</span>;</a>
<a class="sourceLine" id="cb1-340" title="340">    nlines<span class="op">++</span>;</a>
<a class="sourceLine" id="cb1-341" title="341">}</a>
<a class="sourceLine" id="cb1-342" title="342"></a>
<a class="sourceLine" id="cb1-343" title="343"><span class="co"># Another special pattern is called </span><span class="re">END</span><span class="co">. It will run after processing all the</span></a>
<a class="sourceLine" id="cb1-344" title="344"><span class="co"># text files. Unlike </span><span class="re">BEGIN</span><span class="co">, it will only run if you&#39;ve given it input to</span></a>
<a class="sourceLine" id="cb1-345" title="345"><span class="co"># process. It will run after all the files have been read and processed</span></a>
<a class="sourceLine" id="cb1-346" title="346"><span class="co"># according to the rules and actions you&#39;ve provided. The purpose of it is</span></a>
<a class="sourceLine" id="cb1-347" title="347"><span class="co"># usually to output some kind of final report, or do something with the</span></a>
<a class="sourceLine" id="cb1-348" title="348"><span class="co"># aggregate of the data you&#39;ve accumulated over the course of the script.</span></a>
<a class="sourceLine" id="cb1-349" title="349"></a>
<a class="sourceLine" id="cb1-350" title="350"><span class="cf">END</span> {</a>
<a class="sourceLine" id="cb1-351" title="351">    <span class="cf">if</span> (nlines)</a>
<a class="sourceLine" id="cb1-352" title="352">        <span class="kw">print</span> <span class="st">&quot;The average age for &quot;</span> name <span class="st">&quot; is &quot;</span> sum <span class="op">/</span> nlines;</a>
<a class="sourceLine" id="cb1-353" title="353">}</a></code></pre></div>
<p>Further Reading:</p>
<ul>
<li><a href="http://www.grymoire.com/Unix/Awk.html">Awk tutorial</a></li>
<li><a href="https://linux.die.net/man/1/awk">Awk man page</a></li>
<li><a href="https://www.gnu.org/software/gawk/manual/gawk.html">The GNU Awk User’s Guide</a> GNU Awk is found on most Linux systems.</li>
<li><a href="http://tuxgraphics.org/~guido/scripts/awk-one-liner.html">AWK one-liner collection</a></li>
<li><a href="https://wiki.alpinelinux.org/wiki/Awk">Awk alpinelinux wiki</a> a technical summary and list of “gotchas” (places where different implementations may behave in different or unexpected ways).</li>
<li><a href="https://github.com/dubiousjim/awkenough">basic libraries for awk</a></li>
</ul>
</body>
</html>
