<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>tcl.html</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<p>Tcl was created by <a href="https://wiki.tcl-lang.org/page/John+Ousterhout">John Ousterhout</a> as a reusable scripting language for circuit design tools that he authored. In 1997 he was awarded the <a href="https://en.wikipedia.org/wiki/ACM_Software_System_Award">ACM Software System Award</a> for Tcl. Tcl can be used both as an embeddable scripting language and as a general programming language. It can also be used as a portable C library, even in cases where no scripting capability is needed, as it provides data structures such as dynamic strings, lists, and hash tables. The C library also provides portable functionality for loading dynamic libraries, string formatting and code conversion, filesystem operations, network operations, and more. Various features of Tcl stand out:</p>
<ul>
<li><p>Convenient cross-platform networking API</p></li>
<li><p>Fully virtualized filesystem</p></li>
<li><p>Stackable I/O channels</p></li>
<li><p>Asynchronous to the core</p></li>
<li><p>Full coroutines</p></li>
<li><p>A threading model recognized as robust and easy to use</p></li>
</ul>
<p>Tcl has much in common with Lisp, but instead of lists, Tcl uses strings as the currency of the language. All values are strings. A list is a string with a defined format, and the body of a procedure (a script) is also a string rather than a block. To achieve performance, Tcl internally caches structured representations of these values. list routines, for example, operate on the internal cached representation, and Tcl takes care of updating the string representation if it is ever actually needed in the script. The copy-on-write design of Tcl allows script authors to pass around large data values without actually incurring additional memory overhead. Procedures are automatically byte-compiled unless they use the more dynamic routines such as “uplevel”, “upvar”, and “trace”.</p>
<p>Tcl is a pleasure to program in. It will appeal to hacker types who find Lisp, Forth, or Smalltalk interesting, as well as to engineers and scientists who just want to get down to business with a tool that bends to their will. Its discipline of exposing all programmatic functionality as routines, including things like looping and mathematical operations that are usually baked into the syntax of other languages, allows it to fade into the background of whatever domain-specific functionality a project needs. Its syntax, which is even lighter than that of Lisp, just gets out of the way.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode tcl"><code class="sourceCode tcl"><a class="sourceLine" id="cb1-1" title="1"><span class="co">#! /bin/env tclsh</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">###############################################################################</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">## 1. Guidelines</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">###############################################################################</span></a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co"># Tcl is not Sh or C!  This needs to be said because standard shell quoting</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co"># habits almost work in Tcl and it is common for people to pick up Tcl and try</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co"># to get by with syntax they know from another language.  It works at first,</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co"># but soon leads to frustration when scripts become more complex.</span></a>
<a class="sourceLine" id="cb1-11" title="11"></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co"># Braces are a quoting mechanism, not syntax for the construction of code</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co"># blocks or lists. Tcl doesn&#39;t have either of those things.  Braces are used to</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co"># escape special characters, which makes them well-suited for quoting procedure</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co"># bodies and strings that should be interpreted as lists.</span></a>
<a class="sourceLine" id="cb1-16" title="16"></a>
<a class="sourceLine" id="cb1-17" title="17"></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co">###############################################################################</span></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="co">## 2. Syntax</span></a>
<a class="sourceLine" id="cb1-20" title="20"><span class="co">###############################################################################</span></a>
<a class="sourceLine" id="cb1-21" title="21"></a>
<a class="sourceLine" id="cb1-22" title="22"><span class="co"># A script is made up of commands delimited by newlines or semicolons.  Each</span></a>
<a class="sourceLine" id="cb1-23" title="23"><span class="co"># command is a call to a routine.  The first word is the name of a routine to</span></a>
<a class="sourceLine" id="cb1-24" title="24"><span class="co"># call, and subsequent words are arguments to the routine.  Words are delimited</span></a>
<a class="sourceLine" id="cb1-25" title="25"><span class="co"># by whitespace.  Since each argument is a word in the command it is already a</span></a>
<a class="sourceLine" id="cb1-26" title="26"><span class="co"># string, and may be unquoted:</span></a>
<a class="sourceLine" id="cb1-27" title="27"><span class="kw">set</span> part1 Sal</a>
<a class="sourceLine" id="cb1-28" title="28"><span class="kw">set</span> part2 ut; <span class="kw">set</span> part3 ations</a>
<a class="sourceLine" id="cb1-29" title="29"></a>
<a class="sourceLine" id="cb1-30" title="30"></a>
<a class="sourceLine" id="cb1-31" title="31"><span class="co"># a dollar sign introduces variable substitution:</span></a>
<a class="sourceLine" id="cb1-32" title="32"><span class="kw">set</span> greeting <span class="dt">$part1$part2$part3</span></a>
<a class="sourceLine" id="cb1-33" title="33"></a>
<a class="sourceLine" id="cb1-34" title="34"></a>
<a class="sourceLine" id="cb1-35" title="35"><span class="co"># When &quot;set&quot; is given only the name of a variable, it returns the</span></a>
<a class="sourceLine" id="cb1-36" title="36"><span class="co"># value of that variable:</span></a>
<a class="sourceLine" id="cb1-37" title="37"><span class="kw">set</span> part3 ;<span class="co"># Returns the value of the variable.</span></a>
<a class="sourceLine" id="cb1-38" title="38"></a>
<a class="sourceLine" id="cb1-39" title="39"></a>
<a class="sourceLine" id="cb1-40" title="40"><span class="co"># Left and right brackets embed a script to be evaluated for a result to</span></a>
<a class="sourceLine" id="cb1-41" title="41"><span class="co"># substitute into the word:</span></a>
<a class="sourceLine" id="cb1-42" title="42"><span class="kw">set</span> greeting <span class="dt">$part1$part2</span><span class="kw">[set</span> part3<span class="kw">]</span></a>
<a class="sourceLine" id="cb1-43" title="43"></a>
<a class="sourceLine" id="cb1-44" title="44"></a>
<a class="sourceLine" id="cb1-45" title="45"><span class="co"># An embedded script may be composed of multiple commands, the last of which provides</span></a>
<a class="sourceLine" id="cb1-46" title="46"><span class="co"># the result for the substitution:</span></a>
<a class="sourceLine" id="cb1-47" title="47"><span class="kw">set</span> greeting <span class="dt">$greeting</span><span class="kw">[</span></a>
<a class="sourceLine" id="cb1-48" title="48">    <span class="kw">incr</span> i</a>
<a class="sourceLine" id="cb1-49" title="49">    <span class="kw">incr</span> i</a>
<a class="sourceLine" id="cb1-50" title="50">    <span class="kw">incr</span> i</a>
<a class="sourceLine" id="cb1-51" title="51"><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-52" title="52"><span class="kw">puts</span> <span class="dt">$greeting</span> ;<span class="co"># The output is &quot;Salutations3&quot;</span></a>
<a class="sourceLine" id="cb1-53" title="53"></a>
<a class="sourceLine" id="cb1-54" title="54"><span class="co"># Every word in a command is a string, including the name of the routine, so</span></a>
<a class="sourceLine" id="cb1-55" title="55"><span class="co"># substitutions can be used on it as well. Given this variable</span></a>
<a class="sourceLine" id="cb1-56" title="56"><span class="co"># assignment,</span></a>
<a class="sourceLine" id="cb1-57" title="57"><span class="kw">set</span> action pu</a>
<a class="sourceLine" id="cb1-58" title="58"></a>
<a class="sourceLine" id="cb1-59" title="59"><span class="co"># , the following three commands are equivalent:</span></a>
<a class="sourceLine" id="cb1-60" title="60"><span class="kw">puts</span> <span class="dt">$greeting</span></a>
<a class="sourceLine" id="cb1-61" title="61"><span class="dt">${action}</span>ts <span class="dt">$greeting</span> </a>
<a class="sourceLine" id="cb1-62" title="62"><span class="kw">[set</span> action<span class="kw">]</span>ts <span class="dt">$greeting</span></a>
<a class="sourceLine" id="cb1-63" title="63"></a>
<a class="sourceLine" id="cb1-64" title="64"></a>
<a class="sourceLine" id="cb1-65" title="65"><span class="co"># backslash suppresses the special meaning of characters:</span></a>
<a class="sourceLine" id="cb1-66" title="66"><span class="kw">set</span> amount <span class="ch">\$</span><span class="fl">16.42</span></a>
<a class="sourceLine" id="cb1-67" title="67"></a>
<a class="sourceLine" id="cb1-68" title="68"></a>
<a class="sourceLine" id="cb1-69" title="69"><span class="co"># backslash adds special meaning to certain characters:</span></a>
<a class="sourceLine" id="cb1-70" title="70"><span class="kw">puts</span> lots<span class="ch">\n</span>of<span class="ch">\n\n\n\n\n\n</span>newlines</a>
<a class="sourceLine" id="cb1-71" title="71"></a>
<a class="sourceLine" id="cb1-72" title="72"></a>
<a class="sourceLine" id="cb1-73" title="73"><span class="co"># A word enclosed in braces is not subject to any special interpretation or</span></a>
<a class="sourceLine" id="cb1-74" title="74"><span class="co"># substitutions, except that a backslash before a brace is not counted when</span></a>
<a class="sourceLine" id="cb1-75" title="75"><span class="co"># looking for the closing brace:</span></a>
<a class="sourceLine" id="cb1-76" title="76"><span class="kw">set</span> somevar <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-77" title="77">    This <span class="ot">is</span> a literal $ sign, and this <span class="ch">\}</span> escaped</a>
<a class="sourceLine" id="cb1-78" title="78">    brace remains uninterpreted</a>
<a class="sourceLine" id="cb1-79" title="79"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-80" title="80"></a>
<a class="sourceLine" id="cb1-81" title="81"></a>
<a class="sourceLine" id="cb1-82" title="82"><span class="co"># In a word enclosed in double quotes, whitespace characters lose their special</span></a>
<a class="sourceLine" id="cb1-83" title="83"><span class="co"># meaning:</span></a>
<a class="sourceLine" id="cb1-84" title="84"><span class="kw">set</span> <span class="ot">name</span> Neo</a>
<a class="sourceLine" id="cb1-85" title="85"><span class="kw">set</span> greeting <span class="st">&quot;Hello, </span><span class="dt">$</span><span class="st">name&quot;</span></a>
<a class="sourceLine" id="cb1-86" title="86"></a>
<a class="sourceLine" id="cb1-87" title="87"></a>
<a class="sourceLine" id="cb1-88" title="88"><span class="co"># A variable name can be any string:</span></a>
<a class="sourceLine" id="cb1-89" title="89"><span class="kw">set</span> <span class="kw">{</span><span class="ot">first</span> <span class="ot">name</span><span class="kw">}</span> New</a>
<a class="sourceLine" id="cb1-90" title="90"></a>
<a class="sourceLine" id="cb1-91" title="91"></a>
<a class="sourceLine" id="cb1-92" title="92"><span class="co"># The braced form of variable substitution handles more complex variable names:</span></a>
<a class="sourceLine" id="cb1-93" title="93"><span class="kw">set</span> greeting <span class="st">&quot;Hello, </span><span class="dt">$</span><span class="st">{first name}&quot;</span></a>
<a class="sourceLine" id="cb1-94" title="94"></a>
<a class="sourceLine" id="cb1-95" title="95"></a>
<a class="sourceLine" id="cb1-96" title="96"><span class="co"># &quot;set&quot; can always be used instead of variable substitution, and can handle all</span></a>
<a class="sourceLine" id="cb1-97" title="97"><span class="co"># variable names:</span></a>
<a class="sourceLine" id="cb1-98" title="98"><span class="kw">set</span> greeting <span class="st">&quot;Hello, [set {first name}]&quot;</span></a>
<a class="sourceLine" id="cb1-99" title="99"></a>
<a class="sourceLine" id="cb1-100" title="100"></a>
<a class="sourceLine" id="cb1-101" title="101"><span class="co"># To unpack a list into the command, use the expansion operator, &quot;{*}&quot;.  These</span></a>
<a class="sourceLine" id="cb1-102" title="102"><span class="co"># two commands are equivalent:</span></a>
<a class="sourceLine" id="cb1-103" title="103"><span class="kw">set</span> <span class="ot">name</span> Neo</a>
<a class="sourceLine" id="cb1-104" title="104"><span class="kw">set</span> <span class="kw">{</span>*<span class="kw">}{</span><span class="ot">name</span> Neo<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-105" title="105"></a>
<a class="sourceLine" id="cb1-106" title="106"></a>
<a class="sourceLine" id="cb1-107" title="107"><span class="co"># An array is a special variable that is a container for other variables.</span></a>
<a class="sourceLine" id="cb1-108" title="108"><span class="kw">set</span> person(<span class="ot">name</span>) Neo</a>
<a class="sourceLine" id="cb1-109" title="109"><span class="kw">set</span> person(destiny) <span class="kw">{</span>The One<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-110" title="110"><span class="kw">set</span> greeting <span class="st">&quot;Hello, </span><span class="dt">$</span><span class="st">person(name)&quot;</span></a>
<a class="sourceLine" id="cb1-111" title="111"></a>
<a class="sourceLine" id="cb1-112" title="112"></a>
<a class="sourceLine" id="cb1-113" title="113"><span class="co"># &quot;variable&quot; can be used to declare or set variables. In contrast with &quot;set&quot;,</span></a>
<a class="sourceLine" id="cb1-114" title="114"><span class="co"># which uses both the global namespace and the current namespace to resolve a</span></a>
<a class="sourceLine" id="cb1-115" title="115"><span class="co"># variable name, &quot;variable&quot; uses only the current namespace:</span></a>
<a class="sourceLine" id="cb1-116" title="116"><span class="kw">variable</span> <span class="ot">name</span> New</a>
<a class="sourceLine" id="cb1-117" title="117"></a>
<a class="sourceLine" id="cb1-118" title="118"></a>
<a class="sourceLine" id="cb1-119" title="119"><span class="co"># &quot;namespace eval&quot; creates a new namespace if it doesn&#39;t exist.  A namespace</span></a>
<a class="sourceLine" id="cb1-120" title="120"><span class="co"># can contain both routines and variables:</span></a>
<a class="sourceLine" id="cb1-121" title="121"><span class="kw">namespace</span> <span class="kw">eval</span> people <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-122" title="122">    <span class="kw">namespace</span> <span class="kw">eval</span> person1 <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-123" title="123">        <span class="kw">variable</span> <span class="ot">name</span> Neo</a>
<a class="sourceLine" id="cb1-124" title="124">    <span class="kw">}</span></a>
<a class="sourceLine" id="cb1-125" title="125"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-126" title="126"></a>
<a class="sourceLine" id="cb1-127" title="127"></a>
<a class="sourceLine" id="cb1-128" title="128"><span class="co"># Use two or more colons to delimit namespace components in variable names:</span></a>
<a class="sourceLine" id="cb1-129" title="129"><span class="kw">namespace</span> <span class="kw">eval</span> people <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-130" title="130">    <span class="kw">set</span> greeting <span class="st">&quot;Hello </span><span class="dt">$</span><span class="st">person1::name&quot;</span></a>
<a class="sourceLine" id="cb1-131" title="131"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-132" title="132"></a>
<a class="sourceLine" id="cb1-133" title="133"><span class="co"># Two or more colons also delimit namespace components in routine names:</span></a>
<a class="sourceLine" id="cb1-134" title="134"><span class="kw">proc</span> people::person1::speak <span class="kw">{}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-135" title="135">    <span class="kw">puts</span> <span class="kw">{</span>I am The One.<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-136" title="136"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-137" title="137"></a>
<a class="sourceLine" id="cb1-138" title="138"><span class="co"># Fully-qualified names begin with two colons:</span></a>
<a class="sourceLine" id="cb1-139" title="139"><span class="kw">set</span> greeting <span class="st">&quot;Hello </span><span class="dt">$</span><span class="st">::people::person1::name&quot;</span></a>
<a class="sourceLine" id="cb1-140" title="140"></a>
<a class="sourceLine" id="cb1-141" title="141"></a>
<a class="sourceLine" id="cb1-142" title="142"></a>
<a class="sourceLine" id="cb1-143" title="143"><span class="co">###############################################################################</span></a>
<a class="sourceLine" id="cb1-144" title="144"><span class="co">## 3. No More Syntax</span></a>
<a class="sourceLine" id="cb1-145" title="145"><span class="co">###############################################################################</span></a>
<a class="sourceLine" id="cb1-146" title="146"></a>
<a class="sourceLine" id="cb1-147" title="147"><span class="co"># All other functionality is implemented via routines.  From this point on,</span></a>
<a class="sourceLine" id="cb1-148" title="148"><span class="co"># there is no new syntax.  Everything else there is to learn about</span></a>
<a class="sourceLine" id="cb1-149" title="149"><span class="co"># Tcl is about the behaviour of individual routines and what meaning they</span></a>
<a class="sourceLine" id="cb1-150" title="150"><span class="co"># assign to their arguments.</span></a>
<a class="sourceLine" id="cb1-151" title="151"></a>
<a class="sourceLine" id="cb1-152" title="152"></a>
<a class="sourceLine" id="cb1-153" title="153"></a>
<a class="sourceLine" id="cb1-154" title="154"><span class="co">###############################################################################</span></a>
<a class="sourceLine" id="cb1-155" title="155"><span class="co">## 4. Variables and Namespaces</span></a>
<a class="sourceLine" id="cb1-156" title="156"><span class="co">###############################################################################</span></a>
<a class="sourceLine" id="cb1-157" title="157"></a>
<a class="sourceLine" id="cb1-158" title="158"><span class="co"># Each variable and routine is associated with some namespace.</span></a>
<a class="sourceLine" id="cb1-159" title="159"></a>
<a class="sourceLine" id="cb1-160" title="160"><span class="co"># To end up with an interpreter that can do nothing, delete the global</span></a>
<a class="sourceLine" id="cb1-161" title="161"><span class="co"># namespace.  It&#39;s not very useful to do such a thing, but it illustrates the</span></a>
<a class="sourceLine" id="cb1-162" title="162"><span class="co"># nature of Tcl.  The name of the global namespace is actually the empty</span></a>
<a class="sourceLine" id="cb1-163" title="163"><span class="co"># string, but the only way to represent it is as a fully-qualified name. To</span></a>
<a class="sourceLine" id="cb1-164" title="164"><span class="co"># try it out call this routine:</span></a>
<a class="sourceLine" id="cb1-165" title="165"><span class="kw">proc</span> delete_global_namespace <span class="kw">{}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-166" title="166">    <span class="kw">namespace</span> <span class="ot">delete</span> ::</a>
<a class="sourceLine" id="cb1-167" title="167"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-168" title="168"></a>
<a class="sourceLine" id="cb1-169" title="169"><span class="co"># Because &quot;set&quot; always keeps its eye on both the global namespace and the</span></a>
<a class="sourceLine" id="cb1-170" title="170"><span class="co"># current namespace, it&#39;s safer to use &quot;variable&quot; to declare a variable or</span></a>
<a class="sourceLine" id="cb1-171" title="171"><span class="co"># assign a value to a variable.  If a variable called &quot;name&quot; already exists in</span></a>
<a class="sourceLine" id="cb1-172" title="172"><span class="co"># the global namespace, using &quot;set&quot; here will assign a value to the global</span></a>
<a class="sourceLine" id="cb1-173" title="173"><span class="co"># variable instead of to a variable in the current namespace, whereas</span></a>
<a class="sourceLine" id="cb1-174" title="174"><span class="co"># &quot;variable&quot; operates only on the current namespace.</span></a>
<a class="sourceLine" id="cb1-175" title="175"><span class="kw">namespace</span> <span class="kw">eval</span> people <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-176" title="176">    <span class="kw">namespace</span> <span class="kw">eval</span> person1 <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-177" title="177">        <span class="kw">variable</span> <span class="ot">name</span> Neo</a>
<a class="sourceLine" id="cb1-178" title="178">    <span class="kw">}</span></a>
<a class="sourceLine" id="cb1-179" title="179"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-180" title="180"></a>
<a class="sourceLine" id="cb1-181" title="181"><span class="co"># Once a variable is declared in a namespace, [set] sees it instead of seeing</span></a>
<a class="sourceLine" id="cb1-182" title="182"><span class="co"># an identically-named variable in the global namespace:</span></a>
<a class="sourceLine" id="cb1-183" title="183"><span class="kw">namespace</span> <span class="kw">eval</span> people <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-184" title="184">    <span class="kw">namespace</span> <span class="kw">eval</span> person1 <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-185" title="185">        <span class="kw">variable</span> <span class="ot">name</span></a>
<a class="sourceLine" id="cb1-186" title="186">        <span class="kw">set</span> <span class="ot">name</span> Neo</a>
<a class="sourceLine" id="cb1-187" title="187">    <span class="kw">}</span></a>
<a class="sourceLine" id="cb1-188" title="188"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-189" title="189"></a>
<a class="sourceLine" id="cb1-190" title="190"><span class="co"># But if &quot;set&quot; has to create a new variable, it always does it relative to the</span></a>
<a class="sourceLine" id="cb1-191" title="191"><span class="co"># current namespace:</span></a>
<a class="sourceLine" id="cb1-192" title="192"><span class="kw">unset</span> <span class="ot">name</span></a>
<a class="sourceLine" id="cb1-193" title="193"><span class="kw">namespace</span> <span class="kw">eval</span> people <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-194" title="194">    <span class="kw">namespace</span> <span class="kw">eval</span> person1 <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-195" title="195">        <span class="kw">set</span> <span class="ot">name</span> neo</a>
<a class="sourceLine" id="cb1-196" title="196">    <span class="kw">}</span></a>
<a class="sourceLine" id="cb1-197" title="197"></a>
<a class="sourceLine" id="cb1-198" title="198"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-199" title="199"><span class="kw">set</span> people::person1::<span class="ot">name</span></a>
<a class="sourceLine" id="cb1-200" title="200"></a>
<a class="sourceLine" id="cb1-201" title="201"></a>
<a class="sourceLine" id="cb1-202" title="202"><span class="co"># An absolute name always begins with the name of the global namespace (the</span></a>
<a class="sourceLine" id="cb1-203" title="203"><span class="co"># empty string), followed by two colons:</span></a>
<a class="sourceLine" id="cb1-204" title="204"><span class="kw">set</span> ::people::person1::<span class="ot">name</span> Neo</a>
<a class="sourceLine" id="cb1-205" title="205"></a>
<a class="sourceLine" id="cb1-206" title="206"></a>
<a class="sourceLine" id="cb1-207" title="207"><span class="co"># Within a procedure, the &quot;variable&quot; links a variable in the current namespace</span></a>
<a class="sourceLine" id="cb1-208" title="208"><span class="co"># into the local scope:</span></a>
<a class="sourceLine" id="cb1-209" title="209"><span class="kw">namespace</span> <span class="kw">eval</span> people::person1 <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-210" title="210">    <span class="kw">proc</span> fly <span class="kw">{}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-211" title="211">        <span class="kw">variable</span> <span class="ot">name</span></a>
<a class="sourceLine" id="cb1-212" title="212">        <span class="kw">puts</span> <span class="st">&quot;</span><span class="dt">$</span><span class="st">name is flying!&quot;</span></a>
<a class="sourceLine" id="cb1-213" title="213">    <span class="kw">}</span></a>
<a class="sourceLine" id="cb1-214" title="214"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-215" title="215"></a>
<a class="sourceLine" id="cb1-216" title="216"></a>
<a class="sourceLine" id="cb1-217" title="217"></a>
<a class="sourceLine" id="cb1-218" title="218"></a>
<a class="sourceLine" id="cb1-219" title="219"><span class="co">###############################################################################</span></a>
<a class="sourceLine" id="cb1-220" title="220"><span class="co">## 5. Built-in Routines</span></a>
<a class="sourceLine" id="cb1-221" title="221"><span class="co">###############################################################################</span></a>
<a class="sourceLine" id="cb1-222" title="222"></a>
<a class="sourceLine" id="cb1-223" title="223"><span class="co"># Math can be done with the &quot;expr&quot;:</span></a>
<a class="sourceLine" id="cb1-224" title="224"><span class="kw">set</span> a <span class="dv">3</span></a>
<a class="sourceLine" id="cb1-225" title="225"><span class="kw">set</span> b <span class="dv">4</span></a>
<a class="sourceLine" id="cb1-226" title="226"><span class="kw">set</span> c <span class="kw">[expr</span> <span class="kw">{</span><span class="dt">$a</span> + <span class="dt">$b</span><span class="kw">}]</span></a>
<a class="sourceLine" id="cb1-227" title="227"></a>
<a class="sourceLine" id="cb1-228" title="228"><span class="co"># Since &quot;expr&quot; performs variable substitution on its own, brace the expression</span></a>
<a class="sourceLine" id="cb1-229" title="229"><span class="co"># to prevent Tcl from performing variable substitution first.  See</span></a>
<a class="sourceLine" id="cb1-230" title="230"><span class="co"># &quot;https://wiki.tcl-lang.org/page/Brace+your+expr-essions&quot; for details.</span></a>
<a class="sourceLine" id="cb1-231" title="231"></a>
<a class="sourceLine" id="cb1-232" title="232"></a>
<a class="sourceLine" id="cb1-233" title="233"><span class="co"># &quot;expr&quot; understands variable and script substitution:</span></a>
<a class="sourceLine" id="cb1-234" title="234"><span class="kw">set</span> c <span class="kw">[expr</span> <span class="kw">{</span><span class="dt">$a</span> + <span class="kw">[set</span> b<span class="kw">]}]</span></a>
<a class="sourceLine" id="cb1-235" title="235"></a>
<a class="sourceLine" id="cb1-236" title="236"></a>
<a class="sourceLine" id="cb1-237" title="237"><span class="co"># &quot;expr&quot; provides a set of mathematical functions:</span></a>
<a class="sourceLine" id="cb1-238" title="238"><span class="kw">set</span> c <span class="kw">[expr</span> <span class="kw">{</span>pow(<span class="dt">$a</span>,<span class="dt">$b</span>)<span class="kw">}]</span></a>
<a class="sourceLine" id="cb1-239" title="239"></a>
<a class="sourceLine" id="cb1-240" title="240"></a>
<a class="sourceLine" id="cb1-241" title="241"><span class="co"># Mathematical operators are available as routines in the ::tcl::mathop</span></a>
<a class="sourceLine" id="cb1-242" title="242"><span class="co"># namespace:</span></a>
<a class="sourceLine" id="cb1-243" title="243">::tcl::mathop::+ <span class="dv">5</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb1-244" title="244"></a>
<a class="sourceLine" id="cb1-245" title="245"><span class="co"># Routines can be imported from other namespaces:</span></a>
<a class="sourceLine" id="cb1-246" title="246"><span class="kw">namespace</span> import ::tcl::mathop::+</a>
<a class="sourceLine" id="cb1-247" title="247"><span class="kw">set</span> result <span class="kw">[</span>+ <span class="dv">5</span> <span class="dv">3</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-248" title="248"></a>
<a class="sourceLine" id="cb1-249" title="249"></a>
<a class="sourceLine" id="cb1-250" title="250"><span class="co"># Non-numeric values must be quoted, and operators like &quot;eq&quot; can be used to</span></a>
<a class="sourceLine" id="cb1-251" title="251"><span class="co"># constrain the operation to string comparison:</span></a>
<a class="sourceLine" id="cb1-252" title="252"><span class="kw">set</span> <span class="ot">name</span> Neo</a>
<a class="sourceLine" id="cb1-253" title="253"><span class="kw">expr</span> <span class="kw">{{</span>Bob<span class="kw">}</span> eq <span class="dt">$name</span><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-254" title="254"></a>
<a class="sourceLine" id="cb1-255" title="255"><span class="co"># The general operators fall back to string string comparison if numeric</span></a>
<a class="sourceLine" id="cb1-256" title="256"><span class="co"># operation isn&#39;t feasible:</span></a>
<a class="sourceLine" id="cb1-257" title="257"><span class="kw">expr</span> <span class="kw">{{</span>Bob<span class="kw">}</span> == <span class="dt">$name</span><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-258" title="258"></a>
<a class="sourceLine" id="cb1-259" title="259"></a>
<a class="sourceLine" id="cb1-260" title="260"><span class="co"># &quot;proc&quot; creates new routines:</span></a>
<a class="sourceLine" id="cb1-261" title="261"><span class="kw">proc</span> greet <span class="ot">name</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-262" title="262">    <span class="kw">return</span> <span class="st">&quot;Hello, </span><span class="dt">$</span><span class="st">name!&quot;</span></a>
<a class="sourceLine" id="cb1-263" title="263"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-264" title="264"></a>
<a class="sourceLine" id="cb1-265" title="265"><span class="co">#multiple parameters can be specified:</span></a>
<a class="sourceLine" id="cb1-266" title="266"><span class="kw">proc</span> greet <span class="kw">{</span>greeting <span class="ot">name</span><span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-267" title="267">    <span class="kw">return</span> <span class="st">&quot;</span><span class="dt">$</span><span class="st">greeting, </span><span class="dt">$</span><span class="st">name!&quot;</span></a>
<a class="sourceLine" id="cb1-268" title="268"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-269" title="269"></a>
<a class="sourceLine" id="cb1-270" title="270"></a>
<a class="sourceLine" id="cb1-271" title="271"><span class="co"># As noted earlier, braces do not construct a code block.  Every value, even</span></a>
<a class="sourceLine" id="cb1-272" title="272"><span class="co"># the third argument to &quot;proc&quot;, is a string.  The previous command</span></a>
<a class="sourceLine" id="cb1-273" title="273"><span class="co"># can be rewritten using no braces:</span></a>
<a class="sourceLine" id="cb1-274" title="274"><span class="kw">proc</span> greet greeting<span class="ch">\ </span><span class="ot">name</span> <span class="kw">return</span><span class="ch">\ \&quot;\$</span>greeting,<span class="ch">\ \$</span>name!<span class="ch">\&quot;</span></a>
<a class="sourceLine" id="cb1-275" title="275"><span class="co"># &quot;</span></a>
<a class="sourceLine" id="cb1-276" title="276"></a>
<a class="sourceLine" id="cb1-277" title="277"></a>
<a class="sourceLine" id="cb1-278" title="278"></a>
<a class="sourceLine" id="cb1-279" title="279"><span class="co"># When the last parameter is the literal value &quot;args&quot;, all extra arguments</span></a>
<a class="sourceLine" id="cb1-280" title="280"><span class="co"># passed to the routine are collected into a list and assigned to &quot;args&quot;:</span></a>
<a class="sourceLine" id="cb1-281" title="281"><span class="kw">proc</span> fold <span class="kw">{</span>cmd <span class="ot">first</span> <span class="ot">args</span><span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-282" title="282">    <span class="kw">foreach</span> arg <span class="dt">$args</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-283" title="283">        <span class="kw">set</span> <span class="ot">first</span> <span class="kw">[</span><span class="dt">$cmd</span> <span class="dt">$first</span> <span class="dt">$arg</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-284" title="284">    <span class="kw">}</span></a>
<a class="sourceLine" id="cb1-285" title="285">    <span class="kw">return</span> <span class="dt">$first</span></a>
<a class="sourceLine" id="cb1-286" title="286"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-287" title="287">fold ::tcl::mathop::* <span class="dv">5</span> <span class="dv">3</span> <span class="dv">3</span> ;<span class="co"># -&gt;  45</span></a>
<a class="sourceLine" id="cb1-288" title="288"></a>
<a class="sourceLine" id="cb1-289" title="289"></a>
<a class="sourceLine" id="cb1-290" title="290"><span class="co"># Conditional execution is implemented as a routine:</span></a>
<a class="sourceLine" id="cb1-291" title="291"><span class="kw">if</span> <span class="kw">{</span><span class="dv">3</span> &gt; <span class="dv">4</span><span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-292" title="292">    <span class="kw">puts</span> <span class="kw">{</span>This will never happen<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-293" title="293"><span class="kw">}</span> <span class="kw">elseif</span> <span class="kw">{</span><span class="dv">4</span> &gt; <span class="dv">4</span><span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-294" title="294">    <span class="kw">puts</span> <span class="kw">{</span>This will also never happen<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-295" title="295"><span class="kw">}</span> <span class="kw">else</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-296" title="296">    <span class="kw">puts</span> <span class="kw">{</span>This will always happen<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-297" title="297"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-298" title="298"></a>
<a class="sourceLine" id="cb1-299" title="299"></a>
<a class="sourceLine" id="cb1-300" title="300"><span class="co"># Loops are implemented as routines.  The first and third arguments to </span></a>
<a class="sourceLine" id="cb1-301" title="301"><span class="co"># &quot;for&quot; are treated as scripts, while the second argument is treated as</span></a>
<a class="sourceLine" id="cb1-302" title="302"><span class="co"># an expression:</span></a>
<a class="sourceLine" id="cb1-303" title="303"><span class="kw">set</span> res <span class="dv">0</span></a>
<a class="sourceLine" id="cb1-304" title="304"><span class="kw">for</span> <span class="kw">{set</span> i <span class="dv">0</span><span class="kw">}</span> <span class="kw">{</span><span class="dt">$i</span> &lt; <span class="dv">10</span><span class="kw">}</span> <span class="kw">{incr</span> i<span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-305" title="305">    <span class="kw">set</span> res <span class="kw">[expr</span> <span class="kw">{</span><span class="dt">$res</span> + <span class="dt">$i</span><span class="kw">}]</span></a>
<a class="sourceLine" id="cb1-306" title="306"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-307" title="307"><span class="kw">unset</span> res</a>
<a class="sourceLine" id="cb1-308" title="308"></a>
<a class="sourceLine" id="cb1-309" title="309"></a>
<a class="sourceLine" id="cb1-310" title="310"><span class="co"># The first argument to &quot;while&quot; is also treated as an expression:</span></a>
<a class="sourceLine" id="cb1-311" title="311"><span class="kw">set</span> i <span class="dv">0</span></a>
<a class="sourceLine" id="cb1-312" title="312"><span class="kw">while</span> <span class="kw">{</span><span class="dt">$i</span> &lt; <span class="dv">10</span><span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-313" title="313">    <span class="kw">incr</span> i <span class="dv">2</span></a>
<a class="sourceLine" id="cb1-314" title="314"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-315" title="315"></a>
<a class="sourceLine" id="cb1-316" title="316"></a>
<a class="sourceLine" id="cb1-317" title="317"><span class="co"># A list is a string, and items in the list are delimited by whitespace:</span></a>
<a class="sourceLine" id="cb1-318" title="318"><span class="kw">set</span> amounts <span class="dv">10</span><span class="ch">\ </span><span class="dv">33</span><span class="ch">\ </span><span class="dv">18</span></a>
<a class="sourceLine" id="cb1-319" title="319"><span class="kw">set</span> amount <span class="kw">[lindex</span> <span class="dt">$amounts</span> <span class="dv">1</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-320" title="320"></a>
<a class="sourceLine" id="cb1-321" title="321"><span class="co"># Whitespace in a list item must be quoted:</span></a>
<a class="sourceLine" id="cb1-322" title="322"><span class="kw">set</span> inventory <span class="kw">{</span><span class="st">&quot;item 1&quot;</span> item<span class="ch">\ </span><span class="dv">2</span> <span class="kw">{</span>item <span class="dv">3</span><span class="kw">}}</span></a>
<a class="sourceLine" id="cb1-323" title="323"></a>
<a class="sourceLine" id="cb1-324" title="324"></a>
<a class="sourceLine" id="cb1-325" title="325"><span class="co"># It&#39;s generally a better idea to use list routines when modifying lists:</span></a>
<a class="sourceLine" id="cb1-326" title="326"><span class="kw">lappend</span> inventory <span class="kw">{</span>item <span class="dv">1</span><span class="kw">}</span> <span class="kw">{</span>item <span class="dv">2</span><span class="kw">}</span> <span class="kw">{</span>item <span class="dv">3</span><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-327" title="327"></a>
<a class="sourceLine" id="cb1-328" title="328"></a>
<a class="sourceLine" id="cb1-329" title="329"><span class="co"># Braces and backslash can be used to format more complex values in a list.  A</span></a>
<a class="sourceLine" id="cb1-330" title="330"><span class="co"># list looks exactly like a script, except that the newline character and the</span></a>
<a class="sourceLine" id="cb1-331" title="331"><span class="co"># semicolon character lose their special meanings, and there is no script or</span></a>
<a class="sourceLine" id="cb1-332" title="332"><span class="co"># variable substitution.  This feature makes Tcl homoiconic.  There are three</span></a>
<a class="sourceLine" id="cb1-333" title="333"><span class="co"># items in the following list:</span></a>
<a class="sourceLine" id="cb1-334" title="334"><span class="kw">set</span> <span class="ot">values</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-335" title="335"></a>
<a class="sourceLine" id="cb1-336" title="336">    one<span class="ch">\ </span>two</a>
<a class="sourceLine" id="cb1-337" title="337"></a>
<a class="sourceLine" id="cb1-338" title="338">    <span class="kw">{</span>three four<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-339" title="339"></a>
<a class="sourceLine" id="cb1-340" title="340">    five<span class="ch">\{</span>six</a>
<a class="sourceLine" id="cb1-341" title="341"></a>
<a class="sourceLine" id="cb1-342" title="342"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-343" title="343"></a>
<a class="sourceLine" id="cb1-344" title="344"></a>
<a class="sourceLine" id="cb1-345" title="345"><span class="co"># Since, like all values, a list is a string, string operations could be</span></a>
<a class="sourceLine" id="cb1-346" title="346"><span class="co"># performed on it, at the risk of corrupting the formatting of the list:</span></a>
<a class="sourceLine" id="cb1-347" title="347"><span class="kw">set</span> <span class="ot">values</span> <span class="kw">{</span>one two three four<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-348" title="348"><span class="kw">set</span> <span class="ot">values</span> <span class="kw">[string</span> <span class="ot">map</span> <span class="kw">{</span>two <span class="ch">\{</span><span class="kw">}</span> <span class="dt">$values</span><span class="kw">]</span> ;<span class="co"># $values is no-longer a \</span></a>
<a class="sourceLine" id="cb1-349" title="349">    properly-formatted <span class="kw">list</span></a>
<a class="sourceLine" id="cb1-350" title="350"></a>
<a class="sourceLine" id="cb1-351" title="351"></a>
<a class="sourceLine" id="cb1-352" title="352"><span class="co"># The sure-fire way to get a properly-formatted list is to use &quot;list&quot; routines:</span></a>
<a class="sourceLine" id="cb1-353" title="353"><span class="kw">set</span> <span class="ot">values</span> <span class="kw">[list</span> one <span class="ch">\{</span> three four<span class="kw">]</span></a>
<a class="sourceLine" id="cb1-354" title="354"><span class="kw">lappend</span> <span class="ot">values</span> <span class="kw">{</span> <span class="kw">}</span> ;<span class="co"># add a single space as an item in the list</span></a>
<a class="sourceLine" id="cb1-355" title="355"></a>
<a class="sourceLine" id="cb1-356" title="356"></a>
<a class="sourceLine" id="cb1-357" title="357"><span class="co"># Use &quot;eval&quot; to evaluate a value as a script:</span></a>
<a class="sourceLine" id="cb1-358" title="358"><span class="kw">eval</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-359" title="359">    <span class="kw">set</span> <span class="ot">name</span> Neo</a>
<a class="sourceLine" id="cb1-360" title="360">    <span class="kw">set</span> greeting <span class="st">&quot;Hello, </span><span class="dt">$</span><span class="st">name&quot;</span></a>
<a class="sourceLine" id="cb1-361" title="361"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-362" title="362"></a>
<a class="sourceLine" id="cb1-363" title="363"></a>
<a class="sourceLine" id="cb1-364" title="364"><span class="co"># A list can always be passed to &quot;eval&quot; as a script composed of a single</span></a>
<a class="sourceLine" id="cb1-365" title="365"><span class="co"># command:</span></a>
<a class="sourceLine" id="cb1-366" title="366"><span class="kw">eval</span> <span class="kw">{set</span> <span class="ot">name</span> Neo<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-367" title="367"><span class="kw">eval</span> <span class="kw">[list</span> <span class="kw">set</span> greeting <span class="st">&quot;Hello, </span><span class="dt">$</span><span class="st">name&quot;</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-368" title="368"></a>
<a class="sourceLine" id="cb1-369" title="369"></a>
<a class="sourceLine" id="cb1-370" title="370"><span class="co"># Therefore, when using &quot;eval&quot;, use &quot;list&quot; to build up the desired command:</span></a>
<a class="sourceLine" id="cb1-371" title="371"><span class="kw">set</span> <span class="ot">command</span> <span class="kw">{set</span> <span class="ot">name</span><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-372" title="372"><span class="kw">lappend</span> <span class="ot">command</span> <span class="kw">{</span>Archibald Sorbisol<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-373" title="373"><span class="kw">eval</span> <span class="dt">$command</span></a>
<a class="sourceLine" id="cb1-374" title="374"></a>
<a class="sourceLine" id="cb1-375" title="375"></a>
<a class="sourceLine" id="cb1-376" title="376"><span class="co"># A common mistake is not to use list functions when building up a command:</span></a>
<a class="sourceLine" id="cb1-377" title="377"><span class="kw">set</span> <span class="ot">command</span> <span class="kw">{set</span> <span class="ot">name</span><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-378" title="378"><span class="kw">append</span> <span class="ot">command</span> <span class="kw">{</span> Archibald Sorbisol<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-379" title="379">try <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-380" title="380">    <span class="kw">eval</span> <span class="dt">$command</span> ;<span class="co"># The error here is that there are too many arguments \</span></a>
<a class="sourceLine" id="cb1-381" title="381">        to <span class="st">&quot;set&quot;</span> in <span class="kw">{set</span> <span class="ot">name</span> Archibald Sorbisol<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-382" title="382"><span class="kw">}</span> on <span class="kw">error</span> <span class="kw">{</span>result eoptions<span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-383" title="383">    <span class="kw">puts</span> <span class="kw">[list</span> <span class="kw">{</span>received an <span class="kw">error}</span> <span class="dt">$result</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-384" title="384"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-385" title="385"></a>
<a class="sourceLine" id="cb1-386" title="386"><span class="co"># This mistake can easily occur with &quot;subst&quot;:</span></a>
<a class="sourceLine" id="cb1-387" title="387"></a>
<a class="sourceLine" id="cb1-388" title="388"><span class="kw">set</span> replacement <span class="kw">{</span>Archibald Sorbisol<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-389" title="389"><span class="kw">set</span> <span class="ot">command</span> <span class="kw">{set</span> <span class="ot">name</span> <span class="dt">$replacement</span><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-390" title="390"><span class="kw">set</span> <span class="ot">command</span> <span class="kw">[subst</span> <span class="dt">$command</span><span class="kw">]</span> </a>
<a class="sourceLine" id="cb1-391" title="391">try <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-392" title="392">    <span class="kw">eval</span> <span class="dt">$command</span> ;<span class="co"># The same error as before:  too many arguments to &quot;set&quot; in \</span></a>
<a class="sourceLine" id="cb1-393" title="393">        <span class="kw">{set</span> <span class="ot">name</span> Archibald Sorbisol<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-394" title="394"><span class="kw">}</span> trap <span class="kw">{</span>TCL WRONGARGS<span class="kw">}</span> <span class="kw">{</span>result options<span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-395" title="395">    <span class="kw">puts</span> <span class="kw">[list</span> <span class="kw">{</span>received another <span class="kw">error}</span> <span class="dt">$result</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-396" title="396"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-397" title="397"></a>
<a class="sourceLine" id="cb1-398" title="398"></a>
<a class="sourceLine" id="cb1-399" title="399"><span class="co"># &quot;list&quot; correctly formats a value for substitution:</span></a>
<a class="sourceLine" id="cb1-400" title="400"><span class="kw">set</span> replacement <span class="kw">[list</span> <span class="kw">{</span>Archibald Sorbisol<span class="kw">}]</span></a>
<a class="sourceLine" id="cb1-401" title="401"><span class="kw">set</span> <span class="ot">command</span> <span class="kw">{set</span> <span class="ot">name</span> <span class="dt">$replacement</span><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-402" title="402"><span class="kw">set</span> <span class="ot">command</span> <span class="kw">[subst</span> <span class="dt">$command</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-403" title="403"><span class="kw">eval</span> <span class="dt">$command</span></a>
<a class="sourceLine" id="cb1-404" title="404"></a>
<a class="sourceLine" id="cb1-405" title="405"></a>
<a class="sourceLine" id="cb1-406" title="406"><span class="co"># &quot;list&quot; is commonly used to format values for substitution into scripts: There</span></a>
<a class="sourceLine" id="cb1-407" title="407"><span class="co"># are several examples of this, below.</span></a>
<a class="sourceLine" id="cb1-408" title="408"></a>
<a class="sourceLine" id="cb1-409" title="409"></a>
<a class="sourceLine" id="cb1-410" title="410"><span class="co"># &quot;apply&quot; evaluates a two-item list as a routine:</span></a>
<a class="sourceLine" id="cb1-411" title="411"><span class="kw">set</span> cmd <span class="kw">{{</span>greeting <span class="ot">name</span><span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-412" title="412">    <span class="kw">return</span> <span class="st">&quot;</span><span class="dt">$</span><span class="st">greeting, </span><span class="dt">$</span><span class="st">name!&quot;</span></a>
<a class="sourceLine" id="cb1-413" title="413"><span class="kw">}}</span></a>
<a class="sourceLine" id="cb1-414" title="414">apply <span class="dt">$cmd</span> Whaddup Neo</a>
<a class="sourceLine" id="cb1-415" title="415"></a>
<a class="sourceLine" id="cb1-416" title="416"><span class="co"># A third item can be used to specify the namespace to apply the routine in:</span></a>
<a class="sourceLine" id="cb1-417" title="417"><span class="kw">set</span> cmd <span class="kw">[list</span> <span class="kw">{</span>greeting <span class="ot">name</span><span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-418" title="418">    <span class="kw">return</span> <span class="st">&quot;</span><span class="dt">$</span><span class="st">greeting, </span><span class="dt">$</span><span class="st">name!&quot;</span></a>
<a class="sourceLine" id="cb1-419" title="419"><span class="kw">}</span> <span class="kw">[namespace</span> <span class="ot">current</span><span class="kw">]]</span></a>
<a class="sourceLine" id="cb1-420" title="420">apply <span class="dt">$cmd</span> Whaddup Neo</a>
<a class="sourceLine" id="cb1-421" title="421"></a>
<a class="sourceLine" id="cb1-422" title="422"></a>
<a class="sourceLine" id="cb1-423" title="423"><span class="co"># &quot;uplevel&quot; evaluates a script at some higher level in the call stack:</span></a>
<a class="sourceLine" id="cb1-424" title="424"><span class="kw">proc</span> greet <span class="kw">{}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-425" title="425">    <span class="kw">uplevel</span> <span class="kw">{puts</span> <span class="st">&quot;</span><span class="dt">$</span><span class="st">greeting, </span><span class="dt">$</span><span class="st">name&quot;</span><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-426" title="426"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-427" title="427"></a>
<a class="sourceLine" id="cb1-428" title="428"><span class="kw">proc</span> set_double <span class="kw">{</span>varname value<span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-429" title="429">    <span class="kw">if</span> <span class="kw">{[string</span> <span class="ot">is</span> double <span class="dt">$value</span><span class="kw">]}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-430" title="430">        <span class="kw">uplevel</span> <span class="kw">[list</span> <span class="kw">variable</span> <span class="dt">$varname</span> <span class="dt">$value</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-431" title="431">    <span class="kw">}</span> <span class="kw">else</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-432" title="432">        <span class="kw">error</span> <span class="kw">[list</span> <span class="kw">{</span>not a double<span class="kw">}</span> <span class="dt">$value</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-433" title="433">    <span class="kw">}</span></a>
<a class="sourceLine" id="cb1-434" title="434"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-435" title="435"></a>
<a class="sourceLine" id="cb1-436" title="436"></a>
<a class="sourceLine" id="cb1-437" title="437"><span class="co"># &quot;upvar&quot; links a variable at the current level in the call stack to a variable</span></a>
<a class="sourceLine" id="cb1-438" title="438"><span class="co"># at some higher level:</span></a>
<a class="sourceLine" id="cb1-439" title="439"><span class="kw">proc</span> set_double <span class="kw">{</span>varname value<span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-440" title="440">    <span class="kw">if</span> <span class="kw">{[string</span> <span class="ot">is</span> double <span class="dt">$value</span><span class="kw">]}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-441" title="441">        <span class="kw">upvar</span> <span class="dv">1</span> <span class="dt">$varname</span> var</a>
<a class="sourceLine" id="cb1-442" title="442">        <span class="kw">set</span> var <span class="dt">$value</span></a>
<a class="sourceLine" id="cb1-443" title="443">    <span class="kw">}</span> <span class="kw">else</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-444" title="444">        <span class="kw">error</span> <span class="kw">[list</span> <span class="kw">{</span>not a double<span class="kw">}</span> <span class="dt">$value</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-445" title="445">    <span class="kw">}</span></a>
<a class="sourceLine" id="cb1-446" title="446"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-447" title="447"></a>
<a class="sourceLine" id="cb1-448" title="448"></a>
<a class="sourceLine" id="cb1-449" title="449"><span class="co"># Get rid of the built-in &quot;while&quot; routine, and use &quot;proc&quot; to define a new one:</span></a>
<a class="sourceLine" id="cb1-450" title="450"><span class="kw">rename</span> ::<span class="kw">while</span> <span class="kw">{}</span></a>
<a class="sourceLine" id="cb1-451" title="451"><span class="co"># handling is left as an exercise:</span></a>
<a class="sourceLine" id="cb1-452" title="452"><span class="kw">proc</span> <span class="kw">while</span> <span class="kw">{</span>condition <span class="ot">script</span><span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-453" title="453">    <span class="kw">if</span> <span class="kw">{[uplevel</span> <span class="dv">1</span> <span class="kw">[list</span> <span class="kw">expr</span> <span class="dt">$condition</span><span class="kw">]]}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-454" title="454">        <span class="kw">uplevel</span> <span class="dv">1</span> <span class="dt">$script</span></a>
<a class="sourceLine" id="cb1-455" title="455">        tailcall <span class="kw">[namespace</span> which <span class="kw">while]</span> <span class="dt">$condition</span> <span class="dt">$script</span></a>
<a class="sourceLine" id="cb1-456" title="456">    <span class="kw">}</span></a>
<a class="sourceLine" id="cb1-457" title="457"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-458" title="458"></a>
<a class="sourceLine" id="cb1-459" title="459"></a>
<a class="sourceLine" id="cb1-460" title="460"><span class="co"># &quot;coroutine&quot; creates a new call stack, a new routine to enter that call stack,</span></a>
<a class="sourceLine" id="cb1-461" title="461"><span class="co"># and then calls that routine.  &quot;yield&quot; suspends evaluation in that stack and</span></a>
<a class="sourceLine" id="cb1-462" title="462"><span class="co"># returns control to the calling stack:</span></a>
<a class="sourceLine" id="cb1-463" title="463"><span class="kw">proc</span> countdown count <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-464" title="464">    <span class="co"># send something back to the creator of the coroutine, effectively pausing</span></a>
<a class="sourceLine" id="cb1-465" title="465">    <span class="co"># this call stack for the time being.</span></a>
<a class="sourceLine" id="cb1-466" title="466">    yield <span class="kw">[info</span> coroutine<span class="kw">]</span></a>
<a class="sourceLine" id="cb1-467" title="467"></a>
<a class="sourceLine" id="cb1-468" title="468">    <span class="kw">while</span> <span class="kw">{</span><span class="dt">$count</span> &gt; <span class="dv">1</span><span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-469" title="469">        yield <span class="kw">[incr</span> count<span class="ot"> -1</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-470" title="470">    <span class="kw">}</span></a>
<a class="sourceLine" id="cb1-471" title="471">    <span class="kw">return</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb1-472" title="472"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-473" title="473">coroutine countdown1 countdown <span class="dv">3</span></a>
<a class="sourceLine" id="cb1-474" title="474">coroutine countdown2 countdown <span class="dv">5</span></a>
<a class="sourceLine" id="cb1-475" title="475"><span class="kw">puts</span> <span class="kw">[</span>countdown1<span class="kw">]</span> ;<span class="co"># -&gt; 2 </span></a>
<a class="sourceLine" id="cb1-476" title="476"><span class="kw">puts</span> <span class="kw">[</span>countdown2<span class="kw">]</span> ;<span class="co"># -&gt; 4 </span></a>
<a class="sourceLine" id="cb1-477" title="477"><span class="kw">puts</span> <span class="kw">[</span>countdown1<span class="kw">]</span> ;<span class="co"># -&gt; 1 </span></a>
<a class="sourceLine" id="cb1-478" title="478"><span class="kw">puts</span> <span class="kw">[</span>countdown1<span class="kw">]</span> ;<span class="co"># -&gt; 0 </span></a>
<a class="sourceLine" id="cb1-479" title="479"><span class="kw">catch</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-480" title="480">    <span class="kw">puts</span> <span class="kw">[</span>coundown1<span class="kw">]</span> ;<span class="co"># -&gt; invalid command name &quot;countdown1&quot;</span></a>
<a class="sourceLine" id="cb1-481" title="481"><span class="kw">}</span> cres copts </a>
<a class="sourceLine" id="cb1-482" title="482"><span class="kw">puts</span> <span class="dt">$cres</span></a>
<a class="sourceLine" id="cb1-483" title="483"><span class="kw">puts</span> <span class="kw">[</span>countdown2<span class="kw">]</span> ;<span class="co"># -&gt; 3 </span></a>
<a class="sourceLine" id="cb1-484" title="484"></a>
<a class="sourceLine" id="cb1-485" title="485"></a>
<a class="sourceLine" id="cb1-486" title="486"><span class="co"># Coroutine stacks can yield control to each other:</span></a>
<a class="sourceLine" id="cb1-487" title="487"></a>
<a class="sourceLine" id="cb1-488" title="488"><span class="kw">proc</span> pass <span class="kw">{</span>whom <span class="ot">args</span><span class="kw">}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-489" title="489">    <span class="kw">return</span> <span class="kw">[</span>yieldto <span class="dt">$whom</span> <span class="kw">{</span>*<span class="kw">}</span><span class="dt">$args</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-490" title="490"><span class="kw">}</span></a>
<a class="sourceLine" id="cb1-491" title="491"></a>
<a class="sourceLine" id="cb1-492" title="492">coroutine a apply <span class="kw">{{}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-493" title="493">        yield</a>
<a class="sourceLine" id="cb1-494" title="494">        <span class="kw">set</span> result <span class="kw">[</span>pass b <span class="kw">{</span>please pass the salt<span class="kw">}]</span></a>
<a class="sourceLine" id="cb1-495" title="495">        <span class="kw">puts</span> <span class="kw">[list</span> got the <span class="dt">$result</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-496" title="496">        <span class="kw">set</span> result <span class="kw">[</span>pass b <span class="kw">{</span>please pass the pepper<span class="kw">}]</span></a>
<a class="sourceLine" id="cb1-497" title="497">        <span class="kw">puts</span> <span class="kw">[list</span> got the <span class="dt">$result</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-498" title="498"><span class="kw">}}</span></a>
<a class="sourceLine" id="cb1-499" title="499"></a>
<a class="sourceLine" id="cb1-500" title="500">coroutine b apply <span class="kw">{{}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-501" title="501">    <span class="kw">set</span> request <span class="kw">[</span>yield<span class="kw">]</span></a>
<a class="sourceLine" id="cb1-502" title="502">    <span class="kw">while</span> <span class="dv">1</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-503" title="503">        <span class="kw">set</span> response <span class="kw">[</span>pass c <span class="dt">$request</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-504" title="504">        <span class="kw">puts</span> <span class="kw">[list</span> <span class="kw">[info</span> coroutine<span class="kw">]</span> <span class="ot">is</span> now yielding<span class="kw">]</span></a>
<a class="sourceLine" id="cb1-505" title="505">        <span class="kw">set</span> request <span class="kw">[</span>pass a <span class="dt">$response</span><span class="kw">]</span></a>
<a class="sourceLine" id="cb1-506" title="506">    <span class="kw">}</span></a>
<a class="sourceLine" id="cb1-507" title="507"><span class="kw">}}</span></a>
<a class="sourceLine" id="cb1-508" title="508"></a>
<a class="sourceLine" id="cb1-509" title="509">coroutine c apply <span class="kw">{{}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-510" title="510">    <span class="kw">set</span> request <span class="kw">[</span>yield<span class="kw">]</span></a>
<a class="sourceLine" id="cb1-511" title="511">    <span class="kw">while</span> <span class="dv">1</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-512" title="512">        <span class="kw">if</span> <span class="kw">{[string</span> <span class="ot">match</span> *salt* <span class="dt">$request</span><span class="kw">]}</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-513" title="513">            <span class="kw">set</span> request <span class="kw">[</span>pass b salt<span class="kw">]</span></a>
<a class="sourceLine" id="cb1-514" title="514">        <span class="kw">}</span> <span class="kw">else</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb1-515" title="515">            <span class="kw">set</span> request <span class="kw">[</span>pass b huh?<span class="kw">]</span></a>
<a class="sourceLine" id="cb1-516" title="516">        <span class="kw">}</span></a>
<a class="sourceLine" id="cb1-517" title="517">    <span class="kw">}</span></a>
<a class="sourceLine" id="cb1-518" title="518"><span class="kw">}}</span></a>
<a class="sourceLine" id="cb1-519" title="519"></a>
<a class="sourceLine" id="cb1-520" title="520"><span class="co"># get things moving</span></a>
<a class="sourceLine" id="cb1-521" title="521">a</a>
<a class="sourceLine" id="cb1-522" title="522"></a></code></pre></div>
<h2 id="reference">Reference</h2>
<p><a href="https://www.tcl-lang.org">Official Tcl Documentation</a></p>
<p><a href="https://wiki.tcl-lang.org">Tcl Wiki</a></p>
<p><a href="http://www.reddit.com/r/Tcl">Tcl Subreddit</a></p>
</body>
</html>
